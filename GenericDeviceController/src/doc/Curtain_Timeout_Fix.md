# 窗帘设备超时问题修复说明

## 问题描述

在调用窗帘设备时，API总是返回以下错误：
```json
{
  "detail": "Device did not respond in time."
}
```

## 问题原因

### 1. 窗帘控制函数的延迟时间
窗帘设备使用舵机控制，需要多个步骤来完成物理动作：

**开窗帘操作：**
- 设置舵机到90度位置：2000ms延迟
- 根据房间调整角度：1760ms延迟  
- 回到90度位置：2000ms延迟
- **总延迟时间：5760ms (约5.76秒)**

**关窗帘操作：**
- 设置舵机到90度位置：2000ms延迟
- 根据房间调整角度：1720ms延迟
- 回到90度位置：2000ms延迟
- **总延迟时间：5720ms (约5.72秒)**

### 2. API超时时间设置
原来的API超时时间只有3秒：
```python
# smart_home_api/config.py
API_REQUEST_TIMEOUT = 3  # 3秒超时
```

由于窗帘控制需要约6秒时间，远超过3秒的超时限制，所以API总是返回超时错误。

## 解决方案

### 修改API超时时间
将API超时时间从3秒增加到8秒，以容纳窗帘设备的长时间操作：

```python
# smart_home_api/config.py
# 注意：窗帘设备需要较长时间（约6秒）来完成物理动作，所以超时时间设置为8秒
API_REQUEST_TIMEOUT = 8
```

## 影响范围

这个修改不仅解决了窗帘设备的问题，也解决了窗户设备的超时问题：

**窗户控制延迟时间：**
- 开窗：4750ms (约4.75秒)
- 关窗：4700ms (约4.7秒)

原来的3秒超时时间也不够用，现在8秒的超时时间可以正确处理所有舵机设备。

## 测试验证

使用提供的测试脚本验证修复效果：
```bash
cd test
python curtain_test.py
```

## 注意事项

1. **物理动作时间**：舵机设备的物理动作确实需要时间，不能随意缩短延迟时间
2. **用户体验**：8秒的响应时间对用户来说是可以接受的，因为这是物理设备的实际动作时间
3. **系统稳定性**：增加超时时间不会影响系统性能，只是给设备更多时间完成操作

## 相关文件

- `smart_home_api/config.py` - API超时配置
- `GenericDeviceController/src/core/DeviceControl.h` - 窗帘控制函数
- `test/curtain_test.py` - 测试脚本
